# 31 Game CLI 사용 가이드

## 📋 목차
1. [개요](#개요)
2. [실행 방법](#실행-방법)
3. [메뉴 설명](#메뉴-설명)
4. [환경 설정](#환경-설정)
5. [문제 해결](#문제-해결)

---

## 개요

31 Game CLI는 블록체인 기반 31 게임을 터미널에서 쉽게 플레이할 수 있는 인터페이스입니다.

**주요 기능:**
- 🎮 게임 참가 (Token Approve)
- 🎯 숫자 제출 (1, 2, 3 중 선택)
- 🔄 라운드 시작 및 관리
- 📊 실시간 게임 정보 조회
- 💰 잔액 및 상금 확인

---

## 실행 방법

### 방법 1: 편의 스크립트 사용 (권장)

#### CLI 모드 실행
```bash
./run-cli.sh
```

#### REST API 모드 실행
```bash
./run-web.sh
```

### 방법 2: Gradle 직접 사용

#### CLI 모드 실행
```bash
./gradlew bootRun --args='--app.mode=cli --WEB_APP_TYPE=none'
```

#### REST API 모드 실행
```bash
./gradlew bootRun
```

### 방법 3: JAR 파일 실행

먼저 빌드:
```bash
./gradlew clean build -x test
```

#### CLI 모드 실행
```bash
java -jar build/libs/java_eth_demo-0.0.1-SNAPSHOT.jar \
  --app.mode=cli \
  --WEB_APP_TYPE=none
```

#### REST API 모드 실행
```bash
java -jar build/libs/java_eth_demo-0.0.1-SNAPSHOT.jar
```

---

## 메뉴 설명

### 메인 메뉴

```
╔═══════════════════════════════════════╗
║       31 GAME - CLI INTERFACE        ║
╚═══════════════════════════════════════╝
┌─────────────────────────────────────┐
│  1. 게임 참가 (Token Approve)       │
│  2. 숫자 제출 (Submit Number)       │
│  3. 새 라운드 시작                   │
│  4. 현재 라운드 정보 조회            │
│  5. 플레이어 목록 조회               │
│  6. 승자 조회                        │
│  7. 컨트랙트 잔액 조회               │
│  8. 내 토큰 잔액 조회                │
│  9. Allowance 조회                   │
│  0. 종료                             │
└─────────────────────────────────────┘
```

### 1. 게임 참가 (Token Approve)

게임에 참가하기 위해 토큰 사용 권한을 부여합니다.

**입력 정보:**
- Approve할 토큰 양 (ETH 단위)

**예시:**
```
선택> 1
Approve할 토큰 양 (ETH 단위, 예: 100) > 100
⏳ 트랜잭션 전송 중...
✓ 트랜잭션 성공!
  📝 트랜잭션 해시: 0x1234...
  ⛽ Gas 사용량: 45000
```

**주의사항:**
- 게임에 참가하기 전에 반드시 먼저 실행해야 합니다
- 충분한 토큰 잔액이 있어야 합니다

---

### 2. 숫자 제출 (Submit Number)

1, 2, 3 중 하나의 숫자를 선택하여 베팅합니다.

**입력 정보:**
- 제출할 숫자 (1, 2, 또는 3)
- 베팅 금액 (ETH 단위)

**예시:**
```
선택> 2
ℹ 현재 라운드: 1
제출할 숫자 (1, 2, 또는 3) > 2
베팅 금액 (ETH 단위, 예: 10) > 10
ℹ 베팅: 10 ETH = 10000000000000000000 Wei
⏳ 트랜잭션 전송 중...
✓ 트랜잭션 성공!
```

**게임 규칙:**
- 숫자는 1, 2, 3 중 하나만 가능
- 베팅 금액은 10 ETH ~ 50 ETH 사이
- 현재 진행 중인 라운드에만 참가 가능

---

### 3. 새 라운드 시작

현재 라운드가 종료된 후 새 라운드를 시작합니다.

**예시:**
```
선택> 3
ℹ 현재 라운드: 1
ℹ 게임 종료 여부: true
새 라운드를 시작하시겠습니까? (y/n) > y
⏳ 트랜잭션 전송 중...
✓ 새 라운드가 시작되었습니다!
```

**주의사항:**
- 현재 라운드가 종료되어야 실행 가능
- 누구나 새 라운드를 시작할 수 있습니다

---

### 4. 현재 라운드 정보 조회

특정 라운드의 상세 정보를 확인합니다.

**입력 정보:**
- 조회할 라운드 번호 (Enter: 현재 라운드)

**예시:**
```
선택> 4
ℹ 현재 라운드: 1
조회할 라운드 번호 [Enter=현재 라운드] > 
📊 라운드 #1 정보:
  현재 인덱스: 5
  상금 풀: 50000000000000000000 Wei (약 50 ETH)
  게임 종료: false
  승자 비율: 70%
```

---

### 5. 플레이어 목록 조회

특정 라운드에 참가한 플레이어 목록을 확인합니다.

**예시:**
```
선택> 5
ℹ 현재 라운드: 1
조회할 라운드 번호 [Enter=현재 라운드] > 1
👥 라운드 #1 플레이어 목록 (총 3명):

  [1]
      주소: 0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb
      베팅액: 10000000000000000000 Wei (약 10 ETH)

  [2]
      주소: 0x123...
      베팅액: 15000000000000000000 Wei (약 15 ETH)
```

---

### 6. 승자 조회

특정 라운드의 승자를 확인합니다.

**예시:**
```
선택> 6
조회할 라운드 번호 [Enter=현재 라운드] > 1
🏆 라운드 #1 승자:
   0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb

   🎉 축하합니다! 당신이 승자입니다! 🎉
```

---

### 7. 컨트랙트 잔액 조회

게임 컨트랙트가 보유한 토큰 총액을 확인합니다.

**예시:**
```
선택> 7
💰 게임 컨트랙트 토큰 잔액:
   50000000000000000000 Wei
   (약 50 ETH)
```

---

### 8. 내 토큰 잔액 조회

로그인한 계정의 토큰 잔액을 확인합니다.

**예시:**
```
선택> 8
💳 내 토큰 잔액:
   주소: 0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb
   잔액: 1000 ETH
```

---

### 9. Allowance 조회

게임 컨트랙트가 사용할 수 있는 토큰 양을 확인합니다.

**예시:**
```
선택> 9
✓ Approve된 금액:
   소유자: 0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb
   사용자: 0x07770176B7385003482f25D24E6ef9FC6713756E
   금액: 100 ETH

⚠ Approve된 금액이 없습니다. 메뉴 1번을 선택하여 Approve를 먼저 진행해주세요.
```

---

## 환경 설정

### Private Key 관리

#### 방법 1: 환경변수 설정 (권장)

```bash
# Private Key를 환경변수로 설정
export PLAYER_PRIVATE_KEY=0x5a8958f00e3a4ae763ab2e44cb634268bc6bb5e27283ccb93a1002e874d05c93

# CLI 실행 (자동 로그인됨)
./run-cli.sh
```

#### 방법 2: 실행 시 수동 입력

환경변수가 설정되어 있지 않으면 프로그램 시작 시 입력 프롬프트가 나타납니다:

```
Private Key를 입력하세요 (0x로 시작):
Private Key > 0x5a8958f00e3a4ae763ab2e44cb634268bc6bb5e27283ccb93a1002e874d05c93
✓ 로그인 성공!
ℹ 주소: 0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb
```

### 컨트랙트 주소 설정

`src/main/resources/application.properties` 파일에서 설정합니다:

```properties
# ERC20 Token Contract
erc20.contract-address=0x10C274E66c5d92693b82DEf84B8617F7FE838460

# TOGame Contract
togame.contract-address=0x07770176B7385003482f25D24E6ef9FC6713756E
```

---

## 문제 해결

### Q1. "Private Key가 올바르지 않습니다" 에러

**원인:** Private Key 형식이 잘못되었습니다.

**해결:**
- Private Key는 `0x`로 시작해야 합니다
- 64자리 16진수 문자열이어야 합니다
- 예: `0x5a8958f00e3a4ae763ab2e44cb634268bc6bb5e27283ccb93a1002e874d05c93`

---

### Q2. "Approve 실패" 에러

**원인:** 토큰 잔액이 부족하거나 컨트랙트 주소가 잘못되었습니다.

**해결:**
1. 메뉴 8번으로 토큰 잔액 확인
2. `application.properties`의 컨트랙트 주소 확인
3. 네트워크 연결 상태 확인

---

### Q3. "숫자 제출 실패: Current round is not over" 에러

**원인:** 현재 라운드가 이미 종료되었습니다.

**해결:**
- 메뉴 3번으로 새 라운드를 시작하세요

---

### Q4. "Amount should be between 10 and 50" 에러

**원인:** 베팅 금액이 허용 범위를 벗어났습니다.

**해결:**
- 베팅 금액은 10 ETH ~ 50 ETH 사이여야 합니다

---

### Q5. REST API 서버를 종료하고 싶어요

**해결:**
```bash
# 실행 중인 터미널에서
Ctrl + C

# 또는 프로세스 찾아서 종료
ps aux | grep java
kill -9 [PID]
```

---

## 개발 팁

### 로그 레벨 조정

불필요한 로그를 줄이고 싶다면 `application.properties`:

```properties
logging.level.root=ERROR
logging.level.com.healthcoin=INFO
logging.level.org.springframework=ERROR
logging.level.org.web3j=WARN
```

### 여러 계정으로 테스트

```bash
# 터미널 1 (계정 A)
export PLAYER_PRIVATE_KEY=0x5a8958f...
./run-cli.sh

# 터미널 2 (계정 B)
export PLAYER_PRIVATE_KEY=0xbf94234...
./run-cli.sh
```

---

## 라이선스 및 면책조항

⚠️ **주의사항:**
- 이 프로그램은 교육 및 테스트 목적으로만 사용하세요
- Private Key는 절대 공개하지 마세요
- Testnet (Sepolia)에서만 사용하세요
- 실제 자산을 사용하지 마세요

---

## 기술 지원

문제가 발생하면 다음 정보를 포함하여 문의해주세요:
- 에러 메시지
- 실행 명령어
- 사용 중인 네트워크 (Sepolia, Holesky 등)
- Java 버전 (`java -version`)

---

**즐거운 게임 되세요! 🎮✨**

